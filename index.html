
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cleanmap-ui</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="Lovable Generated Project" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://lovable.dev/opengraph-image-p98pqg.png"
    />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta
      property="twitter:image"
      content="https://lovable.dev/opengraph-image-p98pqg.png"
    />
    
    <!-- Refined Content Security Policy to ensure Vite client works properly -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' ws: wss: https://*.lovableproject.com https://*.supabase.co; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.gpteng.co https://*.lovableproject.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://rsms.me; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https:; object-src 'none';" />
  </head>

  <body>
    <div id="root"></div>
    
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    
    <!-- Vite HMR Listener to help debug client connection issues -->
    <script type="text/javascript">
      // Monitor Vite HMR connection
      window.addEventListener('vite:beforeUpdate', function(event) {
        console.log('Vite HMR update detected:', event);
      });
      
      // Global error handler specifically for script loading
      window.addEventListener('error', function(event) {
        if (event.filename && event.filename.includes('vite/client')) {
          console.error('Vite client loading error:', event);
          // Try to provide more diagnostic information
          document.getElementById('root').innerHTML = `
            <div style="padding: 20px; font-family: sans-serif;">
              <h2>Development Environment Error</h2>
              <p>There was a problem loading the Vite development client.</p>
              <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">${event.message}</pre>
              <p>This is often caused by Content Security Policy restrictions or network issues.</p>
              <button onclick="window.location.reload()" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Refresh Page
              </button>
            </div>
          `;
          // Prevent default error handling
          return true;
        }
      }, true);
    </script>
    
    <!-- Main Vite application script -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Script to initialize mock API -->
    <script type="module">
      // Import and initialize mock API
      import { setupMockEmployeeApi } from './src/utils/employeeDebug.ts';
      
      // Set up mock API when the document is loaded
      document.addEventListener('DOMContentLoaded', function() {
        setupMockEmployeeApi();
        
        // Add a fallback UI if the app doesn't load within 3 seconds
        setTimeout(() => {
          const rootElement = document.getElementById('root');
          if (rootElement && rootElement.childNodes.length === 0) {
            console.log('App failed to render, showing debug UI');
            rootElement.innerHTML = `
              <div style="font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
                <h1>Employees Page Debugging Mode</h1>
                <p>The main application is taking longer than expected to load.</p>
                <p>Please check browser console for any errors.</p>
                <div style="margin-top: 20px; padding: 16px; background-color: #f5f5f5; border-radius: 4px;">
                  <h3>Issue Diagnosis:</h3>
                  <p>We're investigating a possible issue with the application initialization.</p>
                </div>
                <button id="debugBtn" style="margin-top: 20px; padding: 8px 16px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">
                  Run Manual Data Check
                </button>
                <div id="debugResults" style="margin-top: 16px;"></div>
              </div>
            `;
            
            const debugBtn = document.getElementById('debugBtn');
            if (debugBtn) {
              debugBtn.addEventListener('click', async function() {
                const debugResults = document.getElementById('debugResults');
                if (debugResults) {
                  debugResults.innerHTML = '<p>Fetching employee data manually...</p>';
                  
                  try {
                    // Import and use the debug utility
                    const { debugEmployeeData } = await import('./src/utils/employeeDebug.ts');
                    const employeeData = await debugEmployeeData();
                    
                    if (employeeData && employeeData.length > 0) {
                      debugResults.innerHTML = `
                        <p style="color: green;">✓ Successfully loaded ${employeeData.length} employee records.</p>
                        <div style="margin-top: 10px; max-height: 300px; overflow: auto; background-color: #f5f5f5; padding: 10px; border-radius: 4px;">
                          <pre style="margin: 0;">${JSON.stringify(employeeData, null, 2)}</pre>
                        </div>
                      `;
                    } else {
                      debugResults.innerHTML = `<p style="color: orange;">⚠️ No employee data returned.</p>`;
                    }
                  } catch (error) {
                    debugResults.innerHTML = `<p style="color: red;">Error fetching data: ${error.message}</p>`;
                    console.error('Manual fetch error:', error);
                  }
                }
              });
            }
          }
        }, 3000);
      });
    </script>
  </body>
</html>
